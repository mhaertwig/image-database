(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{118:function(e,t,a){},122:function(e,t,a){},123:function(e,t,a){},124:function(e,t,a){},125:function(e,t,a){},126:function(e,t,a){},127:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),r=a(16),c=a.n(r),l=(a(58),a(3)),s=a(21),o=a(47),u=a(13),m=a(7),g=a(48),d=a.n(g),p={backendUrl:"//backend.climage.mariohaertwig.de"},h="SET_IMAGES",f="SET_IMAGE",v="SET_PAGES",b="SET_TAG_SUGGESTIONS",E="ADD_IMAGE",y="IMAGE_UPLOADING",j={images:[],pages:[],tagSuggestions:[],isImageUploading:!1};var O=Object(s.c)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return Object(m.a)({},e,{isImageUploading:t.data});case h:return Object(m.a)({},e,{images:Object(u.a)(t.data)});case f:return Object(m.a)({},e,{image:Object(m.a)({},t.data)});case v:return Object(m.a)({},e,{pages:Object(u.a)(t.data)});case b:return Object(m.a)({},e,{tagSuggestions:Object(u.a)(t.data)});case E:return Object(m.a)({},e,{images:[].concat(Object(u.a)(e.images),[t.data])});default:return Object(m.a)({},e)}},Object(s.a)(o.a)),I=a(8),k=a(9),N=a(11),w=a(10),S=a(12),U=a(19),D=a(17),F=a(6),T=a(49),C=(a(63),function(e){var t=e.icon,a=e.exact,n=e.title,r=e.link,c=T[t];return i.a.createElement("div",{className:"HeaderLink"},i.a.createElement(U.b,{exact:a,to:r?"/".concat(r):"/"},i.a.createElement(c,{title:n})))});C.defaultProps={icon:null,link:null,exact:!1};var x=C,A=(a(69),Object(l.b)(function(e){return{isImageUploading:e.isImageUploading,pages:e.pages}},{})(function(e){var t=e.pages,a=e.isImageUploading;return i.a.createElement("div",{className:"Header"},i.a.createElement("div",{className:"inner"},i.a.createElement("div",{className:"header-title"},i.a.createElement(U.b,{to:"/"},i.a.createElement("h1",null,"Climage"),a?i.a.createElement(F.f,{className:"icon-spin"}):null)),i.a.createElement("div",{className:"links"},i.a.createElement(x,{title:"Gallery",icon:"FiImage",exact:!0}),i.a.createElement(x,{title:"Upload",link:"upload",icon:"FiUploadCloud"}),t.map(function(e){return i.a.createElement(x,{key:e.slug,title:e.title,icon:e.icon,link:e.slug})}))))})),P=(a(70),function(e){var t=e.page;return i.a.createElement("div",{className:"PageContent"},i.a.createElement("div",{className:"page-title"},t.title),i.a.createElement("div",{dangerouslySetInnerHTML:{__html:t.content}}))}),G=a(51),_=a.n(G),L=(a(118),function(e){function t(e){var a;return Object(I.a)(this,t),(0,(a=Object(N.a)(this,Object(w.a)(t).call(this,e))).props.dispatchFetchImages)(),a}return Object(S.a)(t,e),Object(k.a)(t,[{key:"render",value:function(){var e=this.props,t=e.images,a=e.dispatchFetchImages,n=e.history;return i.a.createElement("div",{className:"Gallery"},i.a.createElement("input",{className:"image-search",type:"text",placeholder:"Search...",onChange:function(e){(!e.target.value||e.target.value.length>2)&&a(e.target.value)}}),i.a.createElement(_.a,{margin:1,images:t,enableImageSelection:!1,showImageCount:!1,onClickThumbnail:function(e){return n.push("/image/".concat(t[e].slug))}}))}}]),t}(n.Component)),R={dispatchFetchImages:function(e){return function(t){var a="".concat(p.backendUrl,"/core/image/");a+=e?"?search=".concat(e):"",fetch(a).then(function(e){return e.json()}).then(function(e){t({type:h,data:e})})}}},M=Object(l.b)(function(e){return{images:e.images}},R)(L),H=a(52),K=a.n(H),J=(a(122),function(e){var t=e.title,a=e.description,n=e.image,r=e.sidebar;return i.a.createElement("div",{className:"ImagePage"},i.a.createElement("div",{className:"content"},i.a.createElement("div",{className:"field title"},t),i.a.createElement("div",{className:"image"},n),i.a.createElement("div",{className:"field description"},a)),i.a.createElement("div",{className:"sidebar"},r))});J.defaultProps={title:null,description:null,image:null,sidebar:null};var W=J,B=(a(123),function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(N.a)(this,Object(w.a)(t).call(this,e))).state={imageTitle:"",imageDescription:"",imageUrl:null,imageFile:null,tags:[],showError:!1},a.fileInput=null,a.fileReader=new FileReader,a.fileReader.addEventListener("load",function(){a.setState({imageUrl:a.fileReader.result})}),a}return Object(S.a)(t,e),Object(k.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.isImageUploading,n=t.history;!a&&e.isImageUploading&&n.push("/")}},{key:"onDrop",value:function(e){e.preventDefault();var t=["image/png","image/jpeg"];if(e.dataTransfer.items)for(var a=0;a<e.dataTransfer.items.length;a+=1)if(t.includes(e.dataTransfer.items[a].type)){var n=e.dataTransfer.items[a].getAsFile();this.loadImage(n)}}},{key:"loadImage",value:function(e){this.fileReader.readAsDataURL(e),this.setState({imageFile:e})}},{key:"submitData",value:function(){var e=this.props.dispatchAddImage,t=this.state,a=t.tags,n=t.imageTitle,i=t.imageDescription,r=t.imageFile;n&&i&&r?e({tags:JSON.stringify(a),caption:n,description:i,src:r}):this.setState({showError:!0})}},{key:"render",value:function(){var e=this,t=this.state,a=t.imageUrl,n=t.imageTitle,r=t.imageDescription,c=t.tags,l=t.showError,s=this.props,o=s.tagSuggestions,m=s.dispatchFetchTags,g=i.a.createElement(F.e,{className:"icon"});a&&(g=i.a.createElement("img",{className:"image",src:a,alt:"Preview"}));var d=i.a.createElement(F.d,{className:"error-triangle",title:"This field is required"}),p=i.a.createElement(i.a.Fragment,null,l&&!n?d:null,i.a.createElement("input",{className:"input-field image-title",placeholder:"Enter title",value:n,onChange:function(t){return e.setState({imageTitle:t.target.value})}})),h=i.a.createElement(i.a.Fragment,null,l&&!r?d:null,i.a.createElement("textarea",{className:"input-field image-description",placeholder:"Add description",value:r,onChange:function(t){return e.setState({imageDescription:t.target.value})}})),f=i.a.createElement("div",{className:"input-sidebar"},i.a.createElement("div",{className:"tags"},i.a.createElement(K.a,{autofocus:!1,allowNew:!0,tags:c,suggestions:o,handleAddition:function(t){return e.setState({tags:[].concat(Object(u.a)(c),[t])})},handleInputChange:function(e){return m(e)},handleDelete:function(t){var a=Object(u.a)(c);a.splice(t,1),e.setState({tags:a})}})),i.a.createElement("button",{className:"submit-button",type:"submit",onClick:function(){return e.submitData()}},i.a.createElement(F.c,null),"\xa0Upload image"),i.a.createElement("div",{className:"approve-note"},"Note: The page admins have to approve the image before it is visible in the gallery.")),v=i.a.createElement(i.a.Fragment,null,i.a.createElement("input",{type:"file",onChange:function(t){t.target.files.length&&e.loadImage(t.target.files[0])},ref:function(t){e.fileInput=t},style:{display:"none"}}),l&&!a?d:null,i.a.createElement("div",{className:"image-upload",onDragOver:function(e){return e.preventDefault()},onDrop:function(t){return e.onDrop(t)},onClick:function(){return e.fileInput.click()},onKeyPress:function(t){return 13===t.which&&e.fileInput.click()},role:"button",tabIndex:"0"},g));return i.a.createElement(W,{title:p,image:v,description:h,sidebar:f})}}]),t}(n.Component)),q={dispatchAddImage:function(e){return function(t){var a=d()(e);t({type:y,data:!0}),fetch("".concat(p.backendUrl,"/core/image/"),{method:"POST",body:a}).then(function(e){return e.json()}).then(function(e){t({type:E,data:e}),t({type:y,data:!1})})}},dispatchFetchTags:function(e){return function(t){var a="".concat(p.backendUrl,"/core/tag/");a+=e?"?search=".concat(e):"",fetch(a).then(function(e){return e.json()}).then(function(e){t({type:b,data:e})})}}},$=Object(l.b)(function(e){return{isImageUploading:e.isImageUploading,tagSuggestions:e.tagSuggestions}},q)(B),z=a(26),Q=(a(124),function(e){function t(e){var a;Object(I.a)(this,t),(a=Object(N.a)(this,Object(w.a)(t).call(this,e))).state={prev:null,next:null};var n=a.props,i=n.slug,r=n.dispatchFetchImage;return i&&r(i),document.addEventListener("keydown",a.onDocumentKeyDown.bind(Object(z.a)(a))),a}return Object(S.a)(t,e),Object(k.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.slug,n=t.dispatchFetchImage,i=t.image;e.slug!==a&&n(a),e.image!==i&&this.updateSiblingImages()}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatchSetImage)(null),document.removeEventListener("keydown",this.onDocumentKeyDown)}},{key:"onDocumentKeyDown",value:function(e){var t=this.state,a=t.prev,n=t.next;37===e.which&&a?this.loadImage(a.slug):39===e.which&&n&&this.loadImage(n.slug)}},{key:"updateSiblingImages",value:function(){var e=this.props,t=e.image,a=e.images;if(t&&a.length){var n=a.find(function(e){return e.slug===t.slug});if(n){var i=a.indexOf(n);this.setState({prev:a[i-1],next:a[i+1]})}}}},{key:"loadImage",value:function(e){this.props.history.push("/image/".concat(e))}},{key:"render",value:function(){var e=this,t=this.props.image,a=this.state,n=a.prev,r=a.next;t=t||{};var c=i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{style:{display:"".concat(n?"block":"none")},type:"button",className:"prev-image-button",onClick:function(){return e.loadImage(n.slug)}},i.a.createElement(F.a,null)),i.a.createElement("img",{alt:t.caption,src:t.thumbnail_medium}),i.a.createElement("button",{style:{display:"".concat(r?"block":"none")},type:"button",className:"next-image-button",onClick:function(){return e.loadImage(r.slug)}},i.a.createElement(F.b,null))),l=i.a.createElement("ul",{className:"tags"},(t.tags||[]).map(function(e){return i.a.createElement("li",{key:e.name},e.name)}));return i.a.createElement("div",{className:"Preview"},i.a.createElement(W,{title:t.caption,image:c,description:t.description,sidebar:l}))}}]),t}(n.Component)),V={dispatchSetImage:function(e){return function(t){t({type:f,data:e})}},dispatchFetchImage:function(e){return function(t){var a="".concat(p.backendUrl,"/core/image/").concat(e);fetch(a).then(function(e){return e.json()}).then(function(e){t({type:f,data:e})})}}};Q.defaultProps={image:null,images:[]};var X=Object(l.b)(function(e){return{images:e.images,image:e.image}},V)(Q),Y=(a(125),function(e){function t(e){var a;return Object(I.a)(this,t),(0,(a=Object(N.a)(this,Object(w.a)(t).call(this,e))).props.dispatchFetchPages)(),a}return Object(S.a)(t,e),Object(k.a)(t,[{key:"render",value:function(){var e=this.props.pages;return i.a.createElement("div",{className:"Home"},i.a.createElement(U.a,null,i.a.createElement(A,null),i.a.createElement("div",{className:"body"},i.a.createElement(D.a,{exact:!0,path:"/",render:function(e){var t=e.history;return i.a.createElement(M,{history:t})}}),i.a.createElement(D.a,{exact:!0,path:"/image/:slug",render:function(e){var t=e.history,a=e.match;return i.a.createElement(X,{slug:a.params.slug,history:t})}}),i.a.createElement(D.a,{exact:!0,path:"/upload/",component:$}),e.map(function(e){return i.a.createElement(D.a,{path:"/".concat(e.slug,"/"),key:e.slug,render:function(){return i.a.createElement(P,{page:e})}})}))))}}]),t}(n.Component));Y.defaultProps={pages:[]};var Z={dispatchFetchPages:function(){return function(e){fetch("".concat(p.backendUrl,"/core/page/")).then(function(e){return e.json()}).then(function(t){e({type:v,data:t})})}}},ee=Object(l.b)(function(e){return{pages:e.pages}},Z)(Y);a(126),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(i.a.createElement(function(){return i.a.createElement("div",{className:"App"},i.a.createElement(l.a,{store:O},i.a.createElement(ee,null)))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},53:function(e,t,a){e.exports=a(127)},58:function(e,t,a){},63:function(e,t,a){},69:function(e,t,a){},70:function(e,t,a){}},[[53,1,2]]]);
//# sourceMappingURL=main.a439d1de.chunk.js.map